"use strict";var e=require("three"),t=require("three/examples/jsm/controls/OrbitControls");function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var r=i(e);class n{constructor(){this._entities=[],this._entityMap=new Map,this._ids=0}generateNames(){return this._ids++,`entity-${this._ids}`}Add(e,t){t||(t=this.generateNames()),this._entities.push(e),this._entityMap.set(t,e),e.Parent=this}Get(e){return this._entityMap.get(e)}Remove(e){const t=this._entityMap.get(e);t&&(this._entities.splice(this._entities.indexOf(t),1),this._entityMap.delete(e))}Filter(e){this._entities=this._entities.filter(e)}Update(e){for(const t of this._entities)t.Update(e)}}class s{constructor(){this._parent=null}Update(e){}Emit(e,t){}AddHandler(e,t){}set Parent(e){this._parent=e}get Parent(){return this._parent}}exports.Component=class extends s{constructor(){super(),this._parent=null}AddHandler(e,t){this._parent&&this._parent.AddHandler(e,t)}Emit(e,t){this._parent&&this._parent.Emit(e,t)}InitComponent(){}},exports.ComponentBase=s,exports.Entity=class extends s{constructor(){super(),this._children=[],this._name=null,this._handlers={},this._position=new r.Vector3,this._rotation=new r.Euler}AddChild(e){e.Parent=this,this._children.push(e)}RemoveChild(e){const t=this._children.indexOf(e);-1!==t&&this._children.splice(t,1)}Update(e){for(const t of this._children)t.Update(e)}Emit(e,t){if(e in this._handlers)for(const i of this._handlers[e])i({type:e,details:t})}AddHandler(e,t){this._handlers[e]||(this._handlers[e]=[]),this._handlers[e].push(t)}get Name(){return this._name}set Name(e){this._name=e}get Position(){return this._position}set Position(e){this._position.copy(e),this.Emit("update.position",this._position)}set Rotation(e){this._rotation.copy(e),this.Emit("update.rotation",this._rotation)}get Rotation(){return this._rotation}},exports.Project=class{constructor(e,t={}){if(this.options=t,this._orbitControls=null,this._entityController=new n,this._prevTime=null,"string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Could not find root element");this._rootElement=t}else this._rootElement=e;this.createRenderer(),this.createCamera(),this.createScene(),window.addEventListener("resize",this.onWindowResize.bind(this)),this.update()}createRenderer(){this._renderer=new r.WebGLRenderer,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._renderer.outputColorSpace=r.SRGBColorSpace,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=r.PCFSoftShadowMap,this._rootElement.appendChild(this._renderer.domElement)}createCamera(){this._camera=new r.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),this.options.useOrbitControls&&(this._orbitControls=new t.OrbitControls(this._camera,this._renderer.domElement))}createScene(){this._scene=new r.Scene}onWindowResize(){this._renderer.setSize(window.innerWidth,window.innerHeight),this._camera.aspect=window.innerWidth/window.innerHeight,this._camera.updateProjectionMatrix(),this._orbitControls&&this._orbitControls.update()}AddChild(e,t){this._entityController.Add(e,t)}removeChild(e){this._entityController.Remove(e)}update(){requestAnimationFrame((e=>{this._prevTime||(this._prevTime=e),this.update(),this.step(e-this._prevTime),this._renderer.render(this._scene,this._camera),this._prevTime=e}))}step(e){const t=Math.min(1/30,.001*e);this._entityController.Update(t)}get Camera(){return this._camera}};
